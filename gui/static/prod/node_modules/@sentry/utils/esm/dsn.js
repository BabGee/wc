import*as tslib_1 from"../../../tslib/tslib.es6.js";import{SentryError}from"./error.js";var DSN_REGEX=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+))?@)([\w\.-]+)(?::(\d+))?\/(.+)/,ERROR_MESSAGE="Invalid Dsn",Dsn=function(){function Dsn(from){if("string"===typeof from){this._fromString(from)}else{this._fromComponents(from)}this._validate()}Dsn.prototype.toString=function(withPassword){if(void 0===withPassword){withPassword=!1}var _a=this,host=_a.host,path=_a.path,pass=_a.pass,port=_a.port,projectId=_a.projectId,protocol=_a.protocol,user=_a.user;return protocol+"://"+user+(withPassword&&pass?":"+pass:"")+("@"+host+(port?":"+port:"")+"/"+(path?path+"/":path)+projectId)};Dsn.prototype._fromString=function(str){var match=DSN_REGEX.exec(str);if(!match){throw new SentryError(ERROR_MESSAGE)}var _a=tslib_1.__read(match.slice(1),6),protocol=_a[0],user=_a[1],_b=_a[2],pass=void 0===_b?"":_b,host=_a[3],_c=_a[4],port=void 0===_c?"":_c,lastPath=_a[5],path="",projectId=lastPath,split=projectId.split("/");if(1<split.length){path=split.slice(0,-1).join("/");projectId=split.pop()}this._fromComponents({host:host,pass:pass,path:path,projectId:projectId,port:port,protocol:protocol,user:user})};Dsn.prototype._fromComponents=function(components){this.protocol=components.protocol;this.user=components.user;this.pass=components.pass||"";this.host=components.host;this.port=components.port||"";this.path=components.path||"";this.projectId=components.projectId};Dsn.prototype._validate=function(){var _this=this;["protocol","user","host","projectId"].forEach(function(component){if(!_this[component]){throw new SentryError(ERROR_MESSAGE)}});if("http"!==this.protocol&&"https"!==this.protocol){throw new SentryError(ERROR_MESSAGE)}if(this.port&&isNaN(parseInt(this.port,10))){throw new SentryError(ERROR_MESSAGE)}};return Dsn}();export{Dsn};