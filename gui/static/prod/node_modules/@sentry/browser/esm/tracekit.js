import*as tslib_1 from"../../../tslib/tslib.es6.js";var UNKNOWN_FUNCTION="?",chrome=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[-a-z]+:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,gecko=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js))(?::(\d+))?(?::(\d+))?\s*$/i,winjs=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,geckoEval=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,chromeEval=/\((\S*)(?::(\d+))(?::(\d+))\)/;export function computeStackTrace(ex){var stack=null,popSize=ex&&ex.framesToPop;try{stack=computeStackTraceFromStacktraceProp(ex);if(stack){return popFrames(stack,popSize)}}catch(e){}try{stack=computeStackTraceFromStackProp(ex);if(stack){return popFrames(stack,popSize)}}catch(e){}return{message:extractMessage(ex),name:ex&&ex.name,stack:[],failed:!0}}function computeStackTraceFromStackProp(ex){if(!ex||!ex.stack){return null}for(var stack=[],lines=ex.stack.split("\n"),isEval,submatch,parts,element,i=0;i<lines.length;++i){if(parts=chrome.exec(lines[i])){var isNative=parts[2]&&0===parts[2].indexOf("native");isEval=parts[2]&&0===parts[2].indexOf("eval");if(isEval&&(submatch=chromeEval.exec(parts[2]))){parts[2]=submatch[1];parts[3]=submatch[2];parts[4]=submatch[3]}element={url:parts[2],func:parts[1]||UNKNOWN_FUNCTION,args:isNative?[parts[2]]:[],line:parts[3]?+parts[3]:null,column:parts[4]?+parts[4]:null}}else if(parts=winjs.exec(lines[i])){element={url:parts[2],func:parts[1]||UNKNOWN_FUNCTION,args:[],line:+parts[3],column:parts[4]?+parts[4]:null}}else if(parts=gecko.exec(lines[i])){isEval=parts[3]&&-1<parts[3].indexOf(" > eval");if(isEval&&(submatch=geckoEval.exec(parts[3]))){parts[1]=parts[1]||"eval";parts[3]=submatch[1];parts[4]=submatch[2];parts[5]=""}else if(0===i&&!parts[5]&&void 0!==ex.columnNumber){stack[0].column=ex.columnNumber+1}element={url:parts[3],func:parts[1]||UNKNOWN_FUNCTION,args:parts[2]?parts[2].split(","):[],line:parts[4]?+parts[4]:null,column:parts[5]?+parts[5]:null}}else{continue}if(!element.func&&element.line){element.func=UNKNOWN_FUNCTION}stack.push(element)}if(!stack.length){return null}return{message:extractMessage(ex),name:ex.name,stack:stack}}function computeStackTraceFromStacktraceProp(ex){if(!ex||!ex.stacktrace){return null}for(var stacktrace=ex.stacktrace,opera10Regex=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,opera11Regex=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\))? in (.*):\s*$/i,lines=stacktrace.split("\n"),stack=[],parts,line=0,element;line<lines.length;line+=2){element=null;if(parts=opera10Regex.exec(lines[line])){element={url:parts[2],func:parts[3],args:[],line:+parts[1],column:null}}else if(parts=opera11Regex.exec(lines[line])){element={url:parts[6],func:parts[3]||parts[4],args:parts[5]?parts[5].split(","):[],line:+parts[1],column:+parts[2]}}if(element){if(!element.func&&element.line){element.func=UNKNOWN_FUNCTION}stack.push(element)}}if(!stack.length){return null}return{message:extractMessage(ex),name:ex.name,stack:stack}}function popFrames(stacktrace,popSize){try{return tslib_1.__assign({},stacktrace,{stack:stacktrace.stack.slice(popSize)})}catch(e){return stacktrace}}function extractMessage(ex){var message=ex&&ex.message;if(!message){return"No error message"}if(message.error&&"string"===typeof message.error.message){return message.error.message}return message}