import{extractExceptionKeysForMessage,isEvent,normalizeToSize}from"../../utils/esm/index.js";import{computeStackTrace}from"./tracekit.js";var STACKTRACE_LIMIT=50;export function exceptionFromStacktrace(stacktrace){var frames=prepareFramesForEvent(stacktrace.stack),exception={type:stacktrace.name,value:stacktrace.message};if(frames&&frames.length){exception.stacktrace={frames:frames}}if(exception.type===void 0&&""===exception.value){exception.value="Unrecoverable error caught"}return exception}export function eventFromPlainObject(exception,syntheticException,rejection){var event={exception:{values:[{type:isEvent(exception)?exception.constructor.name:rejection?"UnhandledRejection":"Error",value:"Non-Error "+(rejection?"promise rejection":"exception")+" captured with keys: "+extractExceptionKeysForMessage(exception)}]},extra:{__serialized__:normalizeToSize(exception)}};if(syntheticException){var stacktrace=computeStackTrace(syntheticException),frames_1=prepareFramesForEvent(stacktrace.stack);event.stacktrace={frames:frames_1}}return event}export function eventFromStacktrace(stacktrace){var exception=exceptionFromStacktrace(stacktrace);return{exception:{values:[exception]}}}export function prepareFramesForEvent(stack){if(!stack||!stack.length){return[]}var localStack=stack,firstFrameFunction=localStack[0].func||"",lastFrameFunction=localStack[localStack.length-1].func||"";if(-1!==firstFrameFunction.indexOf("captureMessage")||-1!==firstFrameFunction.indexOf("captureException")){localStack=localStack.slice(1)}if(-1!==lastFrameFunction.indexOf("sentryWrapped")){localStack=localStack.slice(0,-1)}return localStack.map(function(frame){return{colno:null===frame.column?void 0:frame.column,filename:frame.url||localStack[0].url,function:frame.func||"?",in_app:!0,lineno:null===frame.line?void 0:frame.line}}).slice(0,STACKTRACE_LIMIT).reverse()}