import{LitElement}from"../../node_modules/lit-element/lit-element.js";import{SerializableElement,Validation}from"../core/serializable-element.js";import{Logger}from"../core/logger.js";export const FormBase=class extends LitElement{static get properties(){return{pos:{type:Number,reflect:!0},sections:Array,head:{type:String,reflect:!0}}}serialize(){for(var elements=this._findElements(),json={},i=0;i<elements.length;i++){const loader=elements[i],l=loader.loadedElement();if(l instanceof SerializableElement){const value=l.getValue();if(!Array.isArray([value])&&"object"===typeof value){Object.entries(value).forEach(([name,value])=>{this._addSerializedElement(json,name,value)})}else{this._addSerializedElement(json,l.getName(),value)}}}return json}validate(){for(var elements=this._findElements(),i=0;i<elements.length;i++){const loader=elements[i],l=loader.loadedElement();if(l instanceof SerializableElement){try{const validation=l.validate();if(validation instanceof Validation){if(!validation.isValid){try{l.invalid(validation)}catch(e){Logger.i.error(e);loader.classList.add("invalid-e-l")}Logger.i.error(loader,l);l.scrollIntoView({behavior:"smooth",block:"end"});return!1}else{try{l.valid(validation)}catch(e){Logger.i.error(e);loader.classList.remove("invalid-e-l")}}}else{Logger.i.alert(`[.validate] must return Validation - ${l.e.name} `)}}catch(e){Logger.i.error(e);Logger.i.alert(e)}}}return!0}_addSerializedElement(json,name,value){if(json[name]===void 0){json[name]=value}else{if(!Array.isArray(json[name])){json[name]=[json[name]]}json[name].push(value)}}getForm(){return this.shadowRoot.querySelector("slot[name='body']").assignedNodes()[0]}_findElements(){for(var nodes=this.getForm().elementLoaders(),submittable=[],i=0;i<nodes.length;i++){var node=nodes[i],tag=node.nodeName.toLowerCase();if("element-loader"===tag){submittable.push(node)}}return submittable}};