import{LitElement}from"../../../node_modules/lit-element/lit-element.js";import{utilsMixin}from"../../core/mixins/utils-mixin.js";import{store}from"../../store.js";import{updateView}from"../../actions/template.js";import template from"../../reducers/template.js";store.addReducers({template});import{GetSection}from"../../core/parsers/commands/get-section.js";import{Logger}from"../../core/logger.js";import{adaptiveUiMixin}from"../../core/mixins/adaptiveui-mixin.js";export const VIEW_MODE_MAIN="main";export const VIEW_MODE_DIALOG="dialog";export class PageViewElement extends adaptiveUiMixin(utilsMixin(LitElement)){constructor(){super();this._snackbarOpened=!1;this.dialogServicesQueue=[];this.dialogsStack=[];this.count=1}shouldUpdate(){return this.active}createRenderRoot(){return this}updateLocationHash(){const hashes=window.location.hash.split("/"),page=hashes[1]||0,tab=hashes[2]||0;let pagePath;const paths=window.location.pathname.split("/");if(4===paths.length){pagePath=`/${paths[1]}/`}else{pagePath=window.location.pathname}history.replaceState(null,null,`${pagePath+window.location.search}#/${page}/${tab}`)}parseParams(){const au=document.querySelector("adaptive-ui"),p=au.getAttribute("params");return p?JSON.parse(p):{}}logout(evt){evt.preventDefault();window.location="/logout/"}_computeLogo(gateway){let defaultUrl="https://ui-avatars.com/api/?background=FFFFFF&name="+gateway.name;if(gateway.iconImage){defaultUrl=`/media/${gateway.iconImage}`}if(gateway.logo){defaultUrl=`/media/${gateway.logo}`}return defaultUrl}static get properties(){return{active:{type:Boolean},dialogServicesQueue:Array,dialogsStack:Array,pages:Array,profile:{type:Object,value:""}}}async _activateLoadSectionInterface(...args){const self=this;let dialog;if(self.view===VIEW_MODE_DIALOG){dialog=this.qs("#dialog");this.dialogsStack.push([dialog.payload,Object.assign({},dialog.params)])}else{store.dispatch(updateView(VIEW_MODE_DIALOG))}this.scrollToTop();await this.updateComplete;dialog=this.qs("#dialog");if(!dialog){Logger.i.warn("[BAD INTERFACE] children must have section-dialog with #dialog");throw new DOMException}if(args[0]instanceof GetSection){dialog.payload=args[0];dialog.loading=!1}else{dialog._loadServiceParams(args[0],args[1])}if(self.view!==VIEW_MODE_DIALOG){store.dispatch(updateView(VIEW_MODE_DIALOG))}}viewMain(){store.dispatch(updateView(VIEW_MODE_MAIN))}mainNavigation(){if(!this.dialogsStack.length){this.viewMain();this.updateLocationHash()}else{const args=this.dialogsStack.pop(),dialog=this.qs("#dialog");dialog.payload=args[0];dialog.params=args[1];dialog.loading=!1}}_gridClasses(el){if(!el.sectionSize){Logger.i.switchConfiguration(`Form ${el} is using default grid sizes`);return"24|24|24"}return el.sectionSize}scrollToTop(){window.scrollTo({top:0,left:0,behavior:"smooth"})}}