export const Paho={};Paho.MQTT=function(global){var MESSAGE_TYPE={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},validate=function(obj,keys){for(var key in obj){if(obj.hasOwnProperty(key)){if(keys.hasOwnProperty(key)){if(typeof obj[key]!==keys[key])throw new Error(format(ERROR.INVALID_TYPE,[typeof obj[key],key]))}else{var errorStr="Unknown property, "+key+". Valid properties are:";for(var key in keys)if(keys.hasOwnProperty(key))errorStr=errorStr+" "+key;throw new Error(errorStr)}}}},scope=function(f,scope){return function(){return f.apply(scope,arguments)}},ERROR={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."},BUFFER_FULL:{code:18,text:"AMQJS0018E Message buffer is full, maximum buffer size: {0}."}},CONNACK_RC={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},format=function(error,substitutions){var text=error.text;if(substitutions){for(var field,start,i=0;i<substitutions.length;i++){field="{"+i+"}";start=text.indexOf(field);if(0<start){var part1=text.substring(0,start),part2=text.substring(start+field.length);text=part1+substitutions[i]+part2}}}return text},MqttProtoIdentifierv3=[0,6,77,81,73,115,100,112,3],MqttProtoIdentifierv4=[0,4,77,81,84,84,4],WireMessage=function(type,options){this.type=type;for(var name in options){if(options.hasOwnProperty(name)){this[name]=options[name]}}};WireMessage.prototype.encode=function(){var first=(15&this.type)<<4,remLength=0,topicStrLength=[],destinationNameLength=0;if(this.messageIdentifier!=void 0)remLength+=2;switch(this.type){case MESSAGE_TYPE.CONNECT:switch(this.mqttVersion){case 3:remLength+=MqttProtoIdentifierv3.length+3;break;case 4:remLength+=MqttProtoIdentifierv4.length+3;break;}remLength+=UTF8Length(this.clientId)+2;if(this.willMessage!=void 0){remLength+=UTF8Length(this.willMessage.destinationName)+2;var willMessagePayloadBytes=this.willMessage.payloadBytes;if(!(willMessagePayloadBytes instanceof Uint8Array))willMessagePayloadBytes=new Uint8Array(payloadBytes);remLength+=willMessagePayloadBytes.byteLength+2}if(this.userName!=void 0)remLength+=UTF8Length(this.userName)+2;if(this.password!=void 0)remLength+=UTF8Length(this.password)+2;break;case MESSAGE_TYPE.SUBSCRIBE:first|=2;for(var i=0;i<this.topics.length;i++){topicStrLength[i]=UTF8Length(this.topics[i]);remLength+=topicStrLength[i]+2}remLength+=this.requestedQos.length;break;case MESSAGE_TYPE.UNSUBSCRIBE:first|=2;for(var i=0;i<this.topics.length;i++){topicStrLength[i]=UTF8Length(this.topics[i]);remLength+=topicStrLength[i]+2}break;case MESSAGE_TYPE.PUBREL:first|=2;break;case MESSAGE_TYPE.PUBLISH:if(this.payloadMessage.duplicate)first|=8;first=first|=this.payloadMessage.qos<<1;if(this.payloadMessage.retained)first|=1;destinationNameLength=UTF8Length(this.payloadMessage.destinationName);remLength+=destinationNameLength+2;var payloadBytes=this.payloadMessage.payloadBytes;remLength+=payloadBytes.byteLength;if(payloadBytes instanceof ArrayBuffer)payloadBytes=new Uint8Array(payloadBytes);else if(!(payloadBytes instanceof Uint8Array))payloadBytes=new Uint8Array(payloadBytes.buffer);break;case MESSAGE_TYPE.DISCONNECT:break;default:;}var mbi=encodeMBI(remLength),pos=mbi.length+1,buffer=new ArrayBuffer(remLength+pos),byteStream=new Uint8Array(buffer);byteStream[0]=first;byteStream.set(mbi,1);if(this.type==MESSAGE_TYPE.PUBLISH)pos=writeString(this.payloadMessage.destinationName,destinationNameLength,byteStream,pos);else if(this.type==MESSAGE_TYPE.CONNECT){switch(this.mqttVersion){case 3:byteStream.set(MqttProtoIdentifierv3,pos);pos+=MqttProtoIdentifierv3.length;break;case 4:byteStream.set(MqttProtoIdentifierv4,pos);pos+=MqttProtoIdentifierv4.length;break;}var connectFlags=0;if(this.cleanSession)connectFlags=2;if(this.willMessage!=void 0){connectFlags|=4;connectFlags|=this.willMessage.qos<<3;if(this.willMessage.retained){connectFlags|=32}}if(this.userName!=void 0)connectFlags|=128;if(this.password!=void 0)connectFlags|=64;byteStream[pos++]=connectFlags;pos=writeUint16(this.keepAliveInterval,byteStream,pos)}if(this.messageIdentifier!=void 0)pos=writeUint16(this.messageIdentifier,byteStream,pos);switch(this.type){case MESSAGE_TYPE.CONNECT:pos=writeString(this.clientId,UTF8Length(this.clientId),byteStream,pos);if(this.willMessage!=void 0){pos=writeString(this.willMessage.destinationName,UTF8Length(this.willMessage.destinationName),byteStream,pos);pos=writeUint16(willMessagePayloadBytes.byteLength,byteStream,pos);byteStream.set(willMessagePayloadBytes,pos);pos+=willMessagePayloadBytes.byteLength}if(this.userName!=void 0)pos=writeString(this.userName,UTF8Length(this.userName),byteStream,pos);if(this.password!=void 0)pos=writeString(this.password,UTF8Length(this.password),byteStream,pos);break;case MESSAGE_TYPE.PUBLISH:byteStream.set(payloadBytes,pos);break;case MESSAGE_TYPE.SUBSCRIBE:for(var i=0;i<this.topics.length;i++){pos=writeString(this.topics[i],topicStrLength[i],byteStream,pos);byteStream[pos++]=this.requestedQos[i]}break;case MESSAGE_TYPE.UNSUBSCRIBE:for(var i=0;i<this.topics.length;i++)pos=writeString(this.topics[i],topicStrLength[i],byteStream,pos);break;default:}return buffer};function decodeMessage(input,pos){var startingPos=pos,first=input[pos],type=first>>4,messageInfo=first&=15;pos+=1;var digit,remLength=0,multiplier=1;do{if(pos==input.length){return[null,startingPos]}digit=input[pos++];remLength+=(127&digit)*multiplier;multiplier*=128}while(0!=(128&digit));var endPos=pos+remLength;if(endPos>input.length){return[null,startingPos]}var wireMessage=new WireMessage(type);switch(type){case MESSAGE_TYPE.CONNACK:var connectAcknowledgeFlags=input[pos++];if(1&connectAcknowledgeFlags)wireMessage.sessionPresent=!0;wireMessage.returnCode=input[pos++];break;case MESSAGE_TYPE.PUBLISH:var qos=3&messageInfo>>1,len=readUint16(input,pos);pos+=2;var topicName=parseUTF8(input,pos,len);pos+=len;if(0<qos){wireMessage.messageIdentifier=readUint16(input,pos);pos+=2}var message=new Paho.MQTT.Message(input.subarray(pos,endPos));if(1==(1&messageInfo))message.retained=!0;if(8==(8&messageInfo))message.duplicate=!0;message.qos=qos;message.destinationName=topicName;wireMessage.payloadMessage=message;break;case MESSAGE_TYPE.PUBACK:case MESSAGE_TYPE.PUBREC:case MESSAGE_TYPE.PUBREL:case MESSAGE_TYPE.PUBCOMP:case MESSAGE_TYPE.UNSUBACK:wireMessage.messageIdentifier=readUint16(input,pos);break;case MESSAGE_TYPE.SUBACK:wireMessage.messageIdentifier=readUint16(input,pos);pos+=2;wireMessage.returnCode=input.subarray(pos,endPos);break;default:;}return[wireMessage,endPos]}function writeUint16(input,buffer,offset){buffer[offset++]=input>>8;buffer[offset++]=input%256;return offset}function writeString(input,utf8Length,buffer,offset){offset=writeUint16(utf8Length,buffer,offset);stringToUTF8(input,buffer,offset);return offset+utf8Length}function readUint16(buffer,offset){return 256*buffer[offset]+buffer[offset+1]}function encodeMBI(number){var output=[,],numBytes=0;do{var digit=number%128;number=number>>7;if(0<number){digit|=128}output[numBytes++]=digit}while(0<number&&4>numBytes);return output}function UTF8Length(input){for(var output=0,i=0,charCode;i<input.length;i++){charCode=input.charCodeAt(i);if(2047<charCode){if(55296<=charCode&&56319>=charCode){i++;output++}output+=3}else if(127<charCode)output+=2;else output++}return output}function stringToUTF8(input,output,start){for(var pos=start,i=0,charCode;i<input.length;i++){charCode=input.charCodeAt(i);if(55296<=charCode&&56319>=charCode){var lowCharCode=input.charCodeAt(++i);if(isNaN(lowCharCode)){throw new Error(format(ERROR.MALFORMED_UNICODE,[charCode,lowCharCode]))}charCode=(charCode-55296<<10)+(lowCharCode-56320)+65536}if(127>=charCode){output[pos++]=charCode}else if(2047>=charCode){output[pos++]=192|31&charCode>>6;output[pos++]=128|63&charCode}else if(65535>=charCode){output[pos++]=224|15&charCode>>12;output[pos++]=128|63&charCode>>6;output[pos++]=128|63&charCode}else{output[pos++]=240|7&charCode>>18;output[pos++]=128|63&charCode>>12;output[pos++]=128|63&charCode>>6;output[pos++]=128|63&charCode}}return output}function parseUTF8(input,offset,length){var _StringfromCharCode=String.fromCharCode,output="",utf16,pos=offset;while(pos<offset+length){var byte1=input[pos++];if(128>byte1)utf16=byte1;else{var byte2=input[pos++]-128;if(0>byte2)throw new Error(format(ERROR.MALFORMED_UTF,[byte1.toString(16),byte2.toString(16),""]));if(224>byte1)utf16=64*(byte1-192)+byte2;else{var byte3=input[pos++]-128;if(0>byte3)throw new Error(format(ERROR.MALFORMED_UTF,[byte1.toString(16),byte2.toString(16),byte3.toString(16)]));if(240>byte1)utf16=4096*(byte1-224)+64*byte2+byte3;else{var byte4=input[pos++]-128;if(0>byte4)throw new Error(format(ERROR.MALFORMED_UTF,[byte1.toString(16),byte2.toString(16),byte3.toString(16),byte4.toString(16)]));if(248>byte1)utf16=262144*(byte1-240)+4096*byte2+64*byte3+byte4;else throw new Error(format(ERROR.MALFORMED_UTF,[byte1.toString(16),byte2.toString(16),byte3.toString(16),byte4.toString(16)]))}}}if(65535<utf16){utf16-=65536;output+=_StringfromCharCode(55296+(utf16>>10));utf16=56320+(1023&utf16)}output+=_StringfromCharCode(utf16)}return output}var Pinger=function(client,window,keepAliveInterval){this._client=client;this._window=window;this._keepAliveInterval=1e3*keepAliveInterval;this.isReset=!1;var pingReq=new WireMessage(MESSAGE_TYPE.PINGREQ).encode(),doTimeout=function(pinger){return function(){return doPing.apply(pinger)}},doPing=function(){if(!this.isReset){this._client._trace("Pinger.doPing","Timed out");this._client._disconnected(ERROR.PING_TIMEOUT.code,format(ERROR.PING_TIMEOUT))}else{this.isReset=!1;this._client._trace("Pinger.doPing","send PINGREQ");this._client.socket.send(pingReq);this.timeout=this._window.setTimeout(doTimeout(this),this._keepAliveInterval)}};this.reset=function(){this.isReset=!0;this._window.clearTimeout(this.timeout);if(0<this._keepAliveInterval)this.timeout=setTimeout(doTimeout(this),this._keepAliveInterval)};this.cancel=function(){this._window.clearTimeout(this.timeout)}},Timeout=function(client,window,timeoutSeconds,action,args){this._window=window;if(!timeoutSeconds)timeoutSeconds=30;this.timeout=setTimeout(function(action,client,args){return function(){return action.apply(client,args)}}(action,client,args),1e3*timeoutSeconds);this.cancel=function(){this._window.clearTimeout(this.timeout)}},ClientImpl=function(uri,host,port,path,clientId){if(!("WebSocket"in global&&null!==global.WebSocket)){throw new Error(format(ERROR.UNSUPPORTED,["WebSocket"]))}if(!("localStorage"in global&&null!==global.localStorage)){throw new Error(format(ERROR.UNSUPPORTED,["localStorage"]))}if(!("ArrayBuffer"in global&&null!==global.ArrayBuffer)){throw new Error(format(ERROR.UNSUPPORTED,["ArrayBuffer"]))}this._trace("Paho.MQTT.Client",uri,host,port,path,clientId);this.host=host;this.port=port;this.path=path;this.uri=uri;this.clientId=clientId;this._wsuri=null;this._localKey=host+":"+port+("/mqtt"!=path?":"+path:"")+":"+clientId+":";this._msg_queue=[];this._buffered_msg_queue=[];this._sentMessages={};this._receivedMessages={};this._notify_msg_sent={};this._message_identifier=1;this._sequence=0;for(var key in localStorage)if(0==key.indexOf("Sent:"+this._localKey)||0==key.indexOf("Received:"+this._localKey))this.restore(key)};ClientImpl.prototype.host;ClientImpl.prototype.port;ClientImpl.prototype.path;ClientImpl.prototype.uri;ClientImpl.prototype.clientId;ClientImpl.prototype.socket;ClientImpl.prototype.connected=!1;ClientImpl.prototype.maxMessageIdentifier=65536;ClientImpl.prototype.connectOptions;ClientImpl.prototype.hostIndex;ClientImpl.prototype.onConnected;ClientImpl.prototype.onConnectionLost;ClientImpl.prototype.onMessageDelivered;ClientImpl.prototype.onMessageArrived;ClientImpl.prototype.traceFunction;ClientImpl.prototype._msg_queue=null;ClientImpl.prototype._buffered_msg_queue=null;ClientImpl.prototype._connectTimeout;ClientImpl.prototype.sendPinger=null;ClientImpl.prototype.receivePinger=null;ClientImpl.prototype._reconnectInterval=0;ClientImpl.prototype._reconnecting=!1;ClientImpl.prototype._reconnectTimeout=null;ClientImpl.prototype.disconnectedPublishing=!1;ClientImpl.prototype.disconnectedBufferSize=5e3;ClientImpl.prototype.receiveBuffer=null;ClientImpl.prototype._traceBuffer=null;ClientImpl.prototype._MAX_TRACE_ENTRIES=100;ClientImpl.prototype.connect=function(connectOptions){var connectOptionsMasked=this._traceMask(connectOptions,"password");this._trace("Client.connect",connectOptionsMasked,this.socket,this.connected);if(this.connected)throw new Error(format(ERROR.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(format(ERROR.INVALID_STATE,["already connected"]));if(this._reconnecting){this._reconnectTimeout.cancel();this._reconnectTimeout=null;this._reconnecting=!1}this.connectOptions=connectOptions;this._reconnectInterval=0;this._reconnecting=!1;if(connectOptions.uris){this.hostIndex=0;this._doConnect(connectOptions.uris[0])}else{this._doConnect(this.uri)}};ClientImpl.prototype.subscribe=function(filter,subscribeOptions){this._trace("Client.subscribe",filter,subscribeOptions);if(!this.connected)throw new Error(format(ERROR.INVALID_STATE,["not connected"]));var wireMessage=new WireMessage(MESSAGE_TYPE.SUBSCRIBE);wireMessage.topics=[filter];if(subscribeOptions.qos!=void 0)wireMessage.requestedQos=[subscribeOptions.qos];else wireMessage.requestedQos=[0];if(subscribeOptions.onSuccess){wireMessage.onSuccess=function(grantedQos){subscribeOptions.onSuccess({invocationContext:subscribeOptions.invocationContext,grantedQos:grantedQos})}}if(subscribeOptions.onFailure){wireMessage.onFailure=function(errorCode){subscribeOptions.onFailure({invocationContext:subscribeOptions.invocationContext,errorCode:errorCode})}}if(subscribeOptions.timeout){wireMessage.timeOut=new Timeout(this,window,subscribeOptions.timeout,subscribeOptions.onFailure,[{invocationContext:subscribeOptions.invocationContext,errorCode:ERROR.SUBSCRIBE_TIMEOUT.code,errorMessage:format(ERROR.SUBSCRIBE_TIMEOUT)}])}this._requires_ack(wireMessage);this._schedule_message(wireMessage)};ClientImpl.prototype.unsubscribe=function(filter,unsubscribeOptions){this._trace("Client.unsubscribe",filter,unsubscribeOptions);if(!this.connected)throw new Error(format(ERROR.INVALID_STATE,["not connected"]));var wireMessage=new WireMessage(MESSAGE_TYPE.UNSUBSCRIBE);wireMessage.topics=[filter];if(unsubscribeOptions.onSuccess){wireMessage.callback=function(){unsubscribeOptions.onSuccess({invocationContext:unsubscribeOptions.invocationContext})}}if(unsubscribeOptions.timeout){wireMessage.timeOut=new Timeout(this,window,unsubscribeOptions.timeout,unsubscribeOptions.onFailure,[{invocationContext:unsubscribeOptions.invocationContext,errorCode:ERROR.UNSUBSCRIBE_TIMEOUT.code,errorMessage:format(ERROR.UNSUBSCRIBE_TIMEOUT)}])}this._requires_ack(wireMessage);this._schedule_message(wireMessage)};ClientImpl.prototype.send=function(message){this._trace("Client.send",message);wireMessage=new WireMessage(MESSAGE_TYPE.PUBLISH);wireMessage.payloadMessage=message;if(this.connected){if(0<message.qos){this._requires_ack(wireMessage)}else if(this.onMessageDelivered){this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)}this._schedule_message(wireMessage)}else{if(this._reconnecting&&this.disconnectedPublishing){var messageCount=Object.keys(this._sentMessages).length+this._buffered_msg_queue.length;if(messageCount>this.disconnectedBufferSize){throw new Error(format(ERROR.BUFFER_FULL,[this.disconnectedBufferSize]))}else{if(0<message.qos){this._requires_ack(wireMessage)}else{wireMessage.sequence=++this._sequence;this._buffered_msg_queue.push(wireMessage)}}}else{throw new Error(format(ERROR.INVALID_STATE,["not connected"]))}}};ClientImpl.prototype.disconnect=function(){this._trace("Client.disconnect");if(this._reconnecting){this._reconnectTimeout.cancel();this._reconnectTimeout=null;this._reconnecting=!1}if(!this.socket)throw new Error(format(ERROR.INVALID_STATE,["not connecting or connected"]));wireMessage=new WireMessage(MESSAGE_TYPE.DISCONNECT);this._notify_msg_sent[wireMessage]=scope(this._disconnected,this);this._schedule_message(wireMessage)};ClientImpl.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date);this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var key in this._sentMessages)this._trace("_sentMessages ",key,this._sentMessages[key]);for(var key in this._receivedMessages)this._trace("_receivedMessages ",key,this._receivedMessages[key]);return this._traceBuffer}};ClientImpl.prototype.startTrace=function(){if(null===this._traceBuffer){this._traceBuffer=[]}this._trace("Client.startTrace",new Date,"@VERSION@")};ClientImpl.prototype.stopTrace=function(){delete this._traceBuffer};ClientImpl.prototype._doConnect=function(wsurl){if(this.connectOptions.useSSL){var uriParts=wsurl.split(":");uriParts[0]="wss";wsurl=uriParts.join(":")}this._wsuri=wsurl;this.connected=!1;if(this._reconnecting){this._reconnectTimeout=new Timeout(this,window,this._reconnectInterval,this._reconnect)}if(4>this.connectOptions.mqttVersion){this.socket=new WebSocket(wsurl,["mqttv3.1"])}else{this.socket=new WebSocket(wsurl,["mqtt"])}this.socket.binaryType="arraybuffer";this.socket.onopen=scope(this._on_socket_open,this);this.socket.onmessage=scope(this._on_socket_message,this);this.socket.onerror=scope(this._on_socket_error,this);this.socket.onclose=scope(this._on_socket_close,this);this.sendPinger=new Pinger(this,window,this.connectOptions.keepAliveInterval);this.receivePinger=new Pinger(this,window,this.connectOptions.keepAliveInterval);if(this._connectTimeout){this._connectTimeout.cancel();this._connectTimeout=null}this._connectTimeout=new Timeout(this,window,this.connectOptions.timeout,this._disconnected,[ERROR.CONNECT_TIMEOUT.code,format(ERROR.CONNECT_TIMEOUT)])};ClientImpl.prototype._schedule_message=function(message){this._msg_queue.push(message);if(this.connected){this._process_queue()}};ClientImpl.prototype.store=function(prefix,wireMessage){var storedMessage={type:wireMessage.type,messageIdentifier:wireMessage.messageIdentifier,version:1};switch(wireMessage.type){case MESSAGE_TYPE.PUBLISH:if(wireMessage.pubRecReceived)storedMessage.pubRecReceived=!0;storedMessage.payloadMessage={};for(var hex="",messageBytes=wireMessage.payloadMessage.payloadBytes,i=0;i<messageBytes.length;i++){if(15>=messageBytes[i])hex=hex+"0"+messageBytes[i].toString(16);else hex=hex+messageBytes[i].toString(16)}storedMessage.payloadMessage.payloadHex=hex;storedMessage.payloadMessage.qos=wireMessage.payloadMessage.qos;storedMessage.payloadMessage.destinationName=wireMessage.payloadMessage.destinationName;if(wireMessage.payloadMessage.duplicate)storedMessage.payloadMessage.duplicate=!0;if(wireMessage.payloadMessage.retained)storedMessage.payloadMessage.retained=!0;if(0==prefix.indexOf("Sent:")){if(wireMessage.sequence===void 0)wireMessage.sequence=++this._sequence;storedMessage.sequence=wireMessage.sequence}break;default:throw Error(format(ERROR.INVALID_STORED_DATA,[key,storedMessage]));}localStorage.setItem(prefix+this._localKey+wireMessage.messageIdentifier,JSON.stringify(storedMessage))};ClientImpl.prototype.restore=function(key){var value=localStorage.getItem(key),storedMessage=JSON.parse(value),wireMessage=new WireMessage(storedMessage.type,storedMessage);switch(storedMessage.type){case MESSAGE_TYPE.PUBLISH:var hex=storedMessage.payloadMessage.payloadHex,buffer=new ArrayBuffer(hex.length/2),byteStream=new Uint8Array(buffer),i=0;while(2<=hex.length){var x=parseInt(hex.substring(0,2),16);hex=hex.substring(2,hex.length);byteStream[i++]=x}var payloadMessage=new Paho.MQTT.Message(byteStream);payloadMessage.qos=storedMessage.payloadMessage.qos;payloadMessage.destinationName=storedMessage.payloadMessage.destinationName;if(storedMessage.payloadMessage.duplicate)payloadMessage.duplicate=!0;if(storedMessage.payloadMessage.retained)payloadMessage.retained=!0;wireMessage.payloadMessage=payloadMessage;break;default:throw Error(format(ERROR.INVALID_STORED_DATA,[key,value]));}if(0==key.indexOf("Sent:"+this._localKey)){wireMessage.payloadMessage.duplicate=!0;this._sentMessages[wireMessage.messageIdentifier]=wireMessage}else if(0==key.indexOf("Received:"+this._localKey)){this._receivedMessages[wireMessage.messageIdentifier]=wireMessage}};ClientImpl.prototype._process_queue=function(){var message=null,fifo=this._msg_queue.reverse();while(message=fifo.pop()){this._socket_send(message);if(this._notify_msg_sent[message]){this._notify_msg_sent[message]();delete this._notify_msg_sent[message]}}};ClientImpl.prototype._requires_ack=function(wireMessage){var messageCount=Object.keys(this._sentMessages).length;if(messageCount>this.maxMessageIdentifier)throw Error("Too many messages:"+messageCount);while(this._sentMessages[this._message_identifier]!==void 0){this._message_identifier++}wireMessage.messageIdentifier=this._message_identifier;this._sentMessages[wireMessage.messageIdentifier]=wireMessage;if(wireMessage.type===MESSAGE_TYPE.PUBLISH){this.store("Sent:",wireMessage)}if(this._message_identifier===this.maxMessageIdentifier){this._message_identifier=1}};ClientImpl.prototype._on_socket_open=function(){var wireMessage=new WireMessage(MESSAGE_TYPE.CONNECT,this.connectOptions);wireMessage.clientId=this.clientId;this._socket_send(wireMessage)};ClientImpl.prototype._on_socket_message=function(event){this._trace("Client._on_socket_message",event.data);for(var messages=this._deframeMessages(event.data),i=0;i<messages.length;i+=1){this._handleMessage(messages[i])}};ClientImpl.prototype._deframeMessages=function(data){var byteArray=new Uint8Array(data);if(this.receiveBuffer){var newData=new Uint8Array(this.receiveBuffer.length+byteArray.length);newData.set(this.receiveBuffer);newData.set(byteArray,this.receiveBuffer.length);byteArray=newData;delete this.receiveBuffer}try{var offset=0,messages=[];while(offset<byteArray.length){var result=decodeMessage(byteArray,offset),wireMessage=result[0];offset=result[1];if(null!==wireMessage){messages.push(wireMessage)}else{break}}if(offset<byteArray.length){this.receiveBuffer=byteArray.subarray(offset)}}catch(error){this._disconnected(ERROR.INTERNAL_ERROR.code,format(ERROR.INTERNAL_ERROR,[error.message,error.stack.toString()]));return}return messages};ClientImpl.prototype._handleMessage=function(wireMessage){this._trace("Client._handleMessage",wireMessage);try{switch(wireMessage.type){case MESSAGE_TYPE.CONNACK:this._connectTimeout.cancel();if(this._reconnectTimeout)this._reconnectTimeout.cancel();if(this.connectOptions.cleanSession){for(var key in this._sentMessages){var sentMessage=this._sentMessages[key];localStorage.removeItem("Sent:"+this._localKey+sentMessage.messageIdentifier)}this._sentMessages={};for(var key in this._receivedMessages){var receivedMessage=this._receivedMessages[key];localStorage.removeItem("Received:"+this._localKey+receivedMessage.messageIdentifier)}this._receivedMessages={}}if(0===wireMessage.returnCode){this.connected=!0;if(this.connectOptions.uris)this.hostIndex=this.connectOptions.uris.length}else{this._disconnected(ERROR.CONNACK_RETURNCODE.code,format(ERROR.CONNACK_RETURNCODE,[wireMessage.returnCode,CONNACK_RC[wireMessage.returnCode]]));break}var sequencedMessages=[];for(var msgId in this._sentMessages){if(this._sentMessages.hasOwnProperty(msgId))sequencedMessages.push(this._sentMessages[msgId])}if(0<this._buffered_msg_queue.length){var msg=null,fifo=this._buffered_msg_queue.reverse();while(msg=fifo.pop()){sequencedMessages.push(msg);if(this.onMessageDelivered)this._notify_msg_sent[msg]=this.onMessageDelivered(msg.payloadMessage)}}for(var sequencedMessages=sequencedMessages.sort(function(a,b){return a.sequence-b.sequence}),i=0,len=sequencedMessages.length,sentMessage;i<len;i++){sentMessage=sequencedMessages[i];if(sentMessage.type==MESSAGE_TYPE.PUBLISH&&sentMessage.pubRecReceived){var pubRelMessage=new WireMessage(MESSAGE_TYPE.PUBREL,{messageIdentifier:sentMessage.messageIdentifier});this._schedule_message(pubRelMessage)}else{this._schedule_message(sentMessage)}}if(this.connectOptions.onSuccess&&!this._reconnecting){this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext})}var reconnected=!1;if(this._reconnecting){reconnected=!0;this._reconnectInterval=0;this._reconnecting=!1}this._connected(reconnected,this._wsuri);this._process_queue();break;case MESSAGE_TYPE.PUBLISH:this._receivePublish(wireMessage);break;case MESSAGE_TYPE.PUBACK:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];if(sentMessage){delete this._sentMessages[wireMessage.messageIdentifier];localStorage.removeItem("Sent:"+this._localKey+wireMessage.messageIdentifier);if(this.onMessageDelivered)this.onMessageDelivered(sentMessage.payloadMessage)}break;case MESSAGE_TYPE.PUBREC:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];if(sentMessage){sentMessage.pubRecReceived=!0;var pubRelMessage=new WireMessage(MESSAGE_TYPE.PUBREL,{messageIdentifier:wireMessage.messageIdentifier});this.store("Sent:",sentMessage);this._schedule_message(pubRelMessage)}break;case MESSAGE_TYPE.PUBREL:var receivedMessage=this._receivedMessages[wireMessage.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+wireMessage.messageIdentifier);if(receivedMessage){this._receiveMessage(receivedMessage);delete this._receivedMessages[wireMessage.messageIdentifier]}var pubCompMessage=new WireMessage(MESSAGE_TYPE.PUBCOMP,{messageIdentifier:wireMessage.messageIdentifier});this._schedule_message(pubCompMessage);break;case MESSAGE_TYPE.PUBCOMP:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];delete this._sentMessages[wireMessage.messageIdentifier];localStorage.removeItem("Sent:"+this._localKey+wireMessage.messageIdentifier);if(this.onMessageDelivered)this.onMessageDelivered(sentMessage.payloadMessage);break;case MESSAGE_TYPE.SUBACK:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];if(sentMessage){if(sentMessage.timeOut)sentMessage.timeOut.cancel();if(128===wireMessage.returnCode[0]){if(sentMessage.onFailure){sentMessage.onFailure(wireMessage.returnCode)}}else if(sentMessage.onSuccess){sentMessage.onSuccess(wireMessage.returnCode)}delete this._sentMessages[wireMessage.messageIdentifier]}break;case MESSAGE_TYPE.UNSUBACK:var sentMessage=this._sentMessages[wireMessage.messageIdentifier];if(sentMessage){if(sentMessage.timeOut)sentMessage.timeOut.cancel();if(sentMessage.callback){sentMessage.callback()}delete this._sentMessages[wireMessage.messageIdentifier]}break;case MESSAGE_TYPE.PINGRESP:this.sendPinger.reset();break;case MESSAGE_TYPE.DISCONNECT:this._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code,format(ERROR.INVALID_MQTT_MESSAGE_TYPE,[wireMessage.type]));break;default:this._disconnected(ERROR.INVALID_MQTT_MESSAGE_TYPE.code,format(ERROR.INVALID_MQTT_MESSAGE_TYPE,[wireMessage.type]));}}catch(error){this._disconnected(ERROR.INTERNAL_ERROR.code,format(ERROR.INTERNAL_ERROR,[error.message,error.stack.toString()]))}};ClientImpl.prototype._on_socket_error=function(error){if(!this._reconnecting){this._disconnected(ERROR.SOCKET_ERROR.code,format(ERROR.SOCKET_ERROR,[error.data]))}};ClientImpl.prototype._on_socket_close=function(){if(!this._reconnecting){this._disconnected(ERROR.SOCKET_CLOSE.code,format(ERROR.SOCKET_CLOSE))}};ClientImpl.prototype._socket_send=function(wireMessage){if(1==wireMessage.type){var wireMessageMasked=this._traceMask(wireMessage,"password");this._trace("Client._socket_send",wireMessageMasked)}else this._trace("Client._socket_send",wireMessage);this.socket.send(wireMessage.encode());this.sendPinger.reset()};ClientImpl.prototype._receivePublish=function(wireMessage){switch(wireMessage.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(wireMessage);break;case 1:var pubAckMessage=new WireMessage(MESSAGE_TYPE.PUBACK,{messageIdentifier:wireMessage.messageIdentifier});this._schedule_message(pubAckMessage);this._receiveMessage(wireMessage);break;case 2:this._receivedMessages[wireMessage.messageIdentifier]=wireMessage;this.store("Received:",wireMessage);var pubRecMessage=new WireMessage(MESSAGE_TYPE.PUBREC,{messageIdentifier:wireMessage.messageIdentifier});this._schedule_message(pubRecMessage);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos);}};ClientImpl.prototype._receiveMessage=function(wireMessage){if(this.onMessageArrived){this.onMessageArrived(wireMessage.payloadMessage)}};ClientImpl.prototype._connected=function(reconnect,uri){if(this.onConnected)this.onConnected({reconnect:reconnect,uri:uri})};ClientImpl.prototype._reconnect=function(){this._trace("Client._reconnect");if(!this.connected){this._reconnecting=!0;this.sendPinger.cancel();this.receivePinger.cancel();if(60>this._reconnectInterval)this._reconnectInterval+=5;if(this.connectOptions.uris){this.hostIndex=0;this._doConnect(this.connectOptions.uris[0])}else{this._doConnect(this.uri)}}};ClientImpl.prototype._disconnected=function(errorCode,errorText){this._trace("Client._disconnected",errorCode,errorText);if(errorCode!==void 0&&this._reconnecting){this._reconnect();return}this.sendPinger.cancel();this.receivePinger.cancel();if(this._connectTimeout){this._connectTimeout.cancel();this._connectTimeout=null}this._msg_queue=[];this._buffered_msg_queue=[];this._notify_msg_sent={};if(this.socket){this.socket.onopen=null;this.socket.onmessage=null;this.socket.onerror=null;this.socket.onclose=null;if(1===this.socket.readyState)this.socket.close();delete this.socket}if(this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1){this.hostIndex++;this._doConnect(this.connectOptions.uris[this.hostIndex])}else{if(errorCode===void 0){errorCode=ERROR.OK.code;errorText=format(ERROR.OK)}if(this.connected){this.connected=!1;if(this.onConnectionLost){this.onConnectionLost({errorCode:errorCode,errorMessage:errorText,reconnect:this.connectOptions.reconnect,uri:this._wsuri})}if(errorCode!==ERROR.OK.code&&this.connectOptions.reconnect){this._reconnectInterval=0;this._reconnect()}}else{if(4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit){this._trace("Failed to connect V4, dropping back to V3");this.connectOptions.mqttVersion=3;if(this.connectOptions.uris){this.hostIndex=0;this._doConnect(this.connectOptions.uris[0])}else{this._doConnect(this.uri)}}else if(this.connectOptions.onFailure){this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:errorCode,errorMessage:errorText})}}}};ClientImpl.prototype._trace=function(){if(this.traceFunction){for(var i in arguments){if("undefined"!==typeof arguments[i])arguments[i]=JSON.stringify(arguments[i])}var record=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:record})}if(null!==this._traceBuffer){for(var i=0,max=arguments.length;i<max;i++){if(this._traceBuffer.length==this._MAX_TRACE_ENTRIES){this._traceBuffer.shift()}if(0===i)this._traceBuffer.push(arguments[i]);else if("undefined"===typeof arguments[i])this._traceBuffer.push(arguments[i]);else this._traceBuffer.push("  "+JSON.stringify(arguments[i]))}}};ClientImpl.prototype._traceMask=function(traceObject,masked){var traceObjectMasked={};for(var attr in traceObject){if(traceObject.hasOwnProperty(attr)){if(attr==masked)traceObjectMasked[attr]="******";else traceObjectMasked[attr]=traceObject[attr]}}return traceObjectMasked};var Client=function(host,port,path,clientId){var uri;if("string"!==typeof host)throw new Error(format(ERROR.INVALID_TYPE,[typeof host,"host"]));if(2==arguments.length){clientId=port;uri=host;var match=uri.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(match){host=match[4]||match[2];port=parseInt(match[7]);path=match[8]}else{throw new Error(format(ERROR.INVALID_ARGUMENT,[host,"host"]))}}else{if(3==arguments.length){clientId=path;path="/mqtt"}if("number"!==typeof port||0>port)throw new Error(format(ERROR.INVALID_TYPE,[typeof port,"port"]));if("string"!==typeof path)throw new Error(format(ERROR.INVALID_TYPE,[typeof path,"path"]));var ipv6AddSBracket=-1!=host.indexOf(":")&&"["!=host.slice(0,1)&&"]"!=host.slice(-1);uri="ws://"+(ipv6AddSBracket?"["+host+"]":host)+":"+port+path}for(var clientIdLength=0,i=0,charCode;i<clientId.length;i++){charCode=clientId.charCodeAt(i);if(55296<=charCode&&56319>=charCode){i++}clientIdLength++}if("string"!==typeof clientId||65535<clientIdLength)throw new Error(format(ERROR.INVALID_ARGUMENT,[clientId,"clientId"]));var client=new ClientImpl(uri,host,port,path,clientId);this._getHost=function(){return host};this._setHost=function(){throw new Error(format(ERROR.UNSUPPORTED_OPERATION))};this._getPort=function(){return port};this._setPort=function(){throw new Error(format(ERROR.UNSUPPORTED_OPERATION))};this._getPath=function(){return path};this._setPath=function(){throw new Error(format(ERROR.UNSUPPORTED_OPERATION))};this._getURI=function(){return uri};this._setURI=function(){throw new Error(format(ERROR.UNSUPPORTED_OPERATION))};this._getClientId=function(){return client.clientId};this._setClientId=function(){throw new Error(format(ERROR.UNSUPPORTED_OPERATION))};this._getOnConnected=function(){return client.onConnected};this._setOnConnected=function(newOnConnected){if("function"===typeof newOnConnected)client.onConnected=newOnConnected;else throw new Error(format(ERROR.INVALID_TYPE,[typeof newOnConnected,"onConnected"]))};this._getDisconnectedPublishing=function(){return client.disconnectedPublishing};this._setDisconnectedPublishing=function(newDisconnectedPublishing){client.disconnectedPublishing=newDisconnectedPublishing};this._getDisconnectedBufferSize=function(){return client.disconnectedBufferSize};this._setDisconnectedBufferSize=function(newDisconnectedBufferSize){client.disconnectedBufferSize=newDisconnectedBufferSize};this._getOnConnectionLost=function(){return client.onConnectionLost};this._setOnConnectionLost=function(newOnConnectionLost){if("function"===typeof newOnConnectionLost)client.onConnectionLost=newOnConnectionLost;else throw new Error(format(ERROR.INVALID_TYPE,[typeof newOnConnectionLost,"onConnectionLost"]))};this._getOnMessageDelivered=function(){return client.onMessageDelivered};this._setOnMessageDelivered=function(newOnMessageDelivered){if("function"===typeof newOnMessageDelivered)client.onMessageDelivered=newOnMessageDelivered;else throw new Error(format(ERROR.INVALID_TYPE,[typeof newOnMessageDelivered,"onMessageDelivered"]))};this._getOnMessageArrived=function(){return client.onMessageArrived};this._setOnMessageArrived=function(newOnMessageArrived){if("function"===typeof newOnMessageArrived)client.onMessageArrived=newOnMessageArrived;else throw new Error(format(ERROR.INVALID_TYPE,[typeof newOnMessageArrived,"onMessageArrived"]))};this._getTrace=function(){return client.traceFunction};this._setTrace=function(trace){if("function"===typeof trace){client.traceFunction=trace}else{throw new Error(format(ERROR.INVALID_TYPE,[typeof trace,"onTrace"]))}};this.connect=function(connectOptions){connectOptions=connectOptions||{};validate(connectOptions,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",reconnect:"boolean",mqttVersion:"number"});if(connectOptions.keepAliveInterval===void 0)connectOptions.keepAliveInterval=60;if(4<connectOptions.mqttVersion||3>connectOptions.mqttVersion){throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.mqttVersion,"connectOptions.mqttVersion"]))}if(connectOptions.mqttVersion===void 0){connectOptions.mqttVersionExplicit=!1;connectOptions.mqttVersion=4}else{connectOptions.mqttVersionExplicit=!0}if(connectOptions.password===void 0&&connectOptions.userName!==void 0)throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.password,"connectOptions.password"]));if(connectOptions.reconnectInterval===void 0)connectOptions.reconnectInterval=10;if(connectOptions.willMessage){if(!(connectOptions.willMessage instanceof Message))throw new Error(format(ERROR.INVALID_TYPE,[connectOptions.willMessage,"connectOptions.willMessage"]));connectOptions.willMessage.stringPayload;if("undefined"===typeof connectOptions.willMessage.destinationName)throw new Error(format(ERROR.INVALID_TYPE,[typeof connectOptions.willMessage.destinationName,"connectOptions.willMessage.destinationName"]))}if("undefined"===typeof connectOptions.cleanSession)connectOptions.cleanSession=!0;if(connectOptions.hosts){if(!(connectOptions.hosts instanceof Array))throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.hosts,"connectOptions.hosts"]));if(1>connectOptions.hosts.length)throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.hosts,"connectOptions.hosts"]));for(var usingURIs=!1,i=0;i<connectOptions.hosts.length;i++){if("string"!==typeof connectOptions.hosts[i])throw new Error(format(ERROR.INVALID_TYPE,[typeof connectOptions.hosts[i],"connectOptions.hosts["+i+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(connectOptions.hosts[i])){if(0==i){usingURIs=!0}else if(!usingURIs){throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.hosts[i],"connectOptions.hosts["+i+"]"]))}}else if(usingURIs){throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.hosts[i],"connectOptions.hosts["+i+"]"]))}}if(!usingURIs){if(!connectOptions.ports)throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.ports,"connectOptions.ports"]));if(!(connectOptions.ports instanceof Array))throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.ports,"connectOptions.ports"]));if(connectOptions.hosts.length!=connectOptions.ports.length)throw new Error(format(ERROR.INVALID_ARGUMENT,[connectOptions.ports,"connectOptions.ports"]));connectOptions.uris=[];for(var i=0;i<connectOptions.hosts.length;i++){if("number"!==typeof connectOptions.ports[i]||0>connectOptions.ports[i])throw new Error(format(ERROR.INVALID_TYPE,[typeof connectOptions.ports[i],"connectOptions.ports["+i+"]"]));var host=connectOptions.hosts[i],port=connectOptions.ports[i],ipv6=-1!=host.indexOf(":");uri="ws://"+(ipv6?"["+host+"]":host)+":"+port+path;connectOptions.uris.push(uri)}}else{connectOptions.uris=connectOptions.hosts}}client.connect(connectOptions)};this.subscribe=function(filter,subscribeOptions){if("string"!==typeof filter)throw new Error("Invalid argument:"+filter);subscribeOptions=subscribeOptions||{};validate(subscribeOptions,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"});if(subscribeOptions.timeout&&!subscribeOptions.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if("undefined"!==typeof subscribeOptions.qos&&!(0===subscribeOptions.qos||1===subscribeOptions.qos||2===subscribeOptions.qos))throw new Error(format(ERROR.INVALID_ARGUMENT,[subscribeOptions.qos,"subscribeOptions.qos"]));client.subscribe(filter,subscribeOptions)};this.unsubscribe=function(filter,unsubscribeOptions){if("string"!==typeof filter)throw new Error("Invalid argument:"+filter);unsubscribeOptions=unsubscribeOptions||{};validate(unsubscribeOptions,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"});if(unsubscribeOptions.timeout&&!unsubscribeOptions.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");client.unsubscribe(filter,unsubscribeOptions)};this.send=function(topic,payload,qos,retained){var message;if(0==arguments.length){throw new Error("Invalid argument."+"length")}else if(1==arguments.length){if(!(topic instanceof Message)&&"string"!==typeof topic)throw new Error("Invalid argument:"+typeof topic);message=topic;if("undefined"===typeof message.destinationName)throw new Error(format(ERROR.INVALID_ARGUMENT,[message.destinationName,"Message.destinationName"]));client.send(message)}else{message=new Message(payload);message.destinationName=topic;if(3<=arguments.length)message.qos=qos;if(4<=arguments.length)message.retained=retained;client.send(message)}};this.disconnect=function(){client.disconnect()};this.getTraceLog=function(){return client.getTraceLog()};this.startTrace=function(){client.startTrace()};this.stopTrace=function(){client.stopTrace()};this.isConnected=function(){return client.connected}};Client.prototype={get host(){return this._getHost()},set host(newHost){this._setHost(newHost)},get port(){return this._getPort()},set port(newPort){this._setPort(newPort)},get path(){return this._getPath()},set path(newPath){this._setPath(newPath)},get clientId(){return this._getClientId()},set clientId(newClientId){this._setClientId(newClientId)},get onConnected(){return this._getOnConnected()},set onConnected(newOnConnected){this._setOnConnected(newOnConnected)},get disconnectedPublishing(){return this._getDisconnectedPublishing()},set disconnectedPublishing(newDisconnectedPublishing){this._setDisconnectedPublishing(newDisconnectedPublishing)},get disconnectedBufferSize(){return this._getDisconnectedBufferSize()},set disconnectedBufferSize(newDisconnectedBufferSize){this._setDisconnectedBufferSize(newDisconnectedBufferSize)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(newOnConnectionLost){this._setOnConnectionLost(newOnConnectionLost)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(newOnMessageDelivered){this._setOnMessageDelivered(newOnMessageDelivered)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(newOnMessageArrived){this._setOnMessageArrived(newOnMessageArrived)},get trace(){return this._getTrace()},set trace(newTraceFunction){this._setTrace(newTraceFunction)}};var Message=function(newPayload){var payload;if("string"===typeof newPayload||newPayload instanceof ArrayBuffer||newPayload instanceof Int8Array||newPayload instanceof Uint8Array||newPayload instanceof Int16Array||newPayload instanceof Uint16Array||newPayload instanceof Int32Array||newPayload instanceof Uint32Array||newPayload instanceof Float32Array||newPayload instanceof Float64Array){payload=newPayload}else{throw format(ERROR.INVALID_ARGUMENT,[newPayload,"newPayload"])}this._getPayloadString=function(){if("string"===typeof payload)return payload;else return parseUTF8(payload,0,payload.length)};this._getPayloadBytes=function(){if("string"===typeof payload){var buffer=new ArrayBuffer(UTF8Length(payload)),byteStream=new Uint8Array(buffer);stringToUTF8(payload,byteStream,0);return byteStream}else{return payload}};var destinationName;this._getDestinationName=function(){return destinationName};this._setDestinationName=function(newDestinationName){if("string"===typeof newDestinationName)destinationName=newDestinationName;else throw new Error(format(ERROR.INVALID_ARGUMENT,[newDestinationName,"newDestinationName"]))};var qos=0;this._getQos=function(){return qos};this._setQos=function(newQos){if(0===newQos||1===newQos||2===newQos)qos=newQos;else throw new Error("Invalid argument:"+newQos)};var retained=!1;this._getRetained=function(){return retained};this._setRetained=function(newRetained){if("boolean"===typeof newRetained)retained=newRetained;else throw new Error(format(ERROR.INVALID_ARGUMENT,[newRetained,"newRetained"]))};var duplicate=!1;this._getDuplicate=function(){return duplicate};this._setDuplicate=function(newDuplicate){duplicate=newDuplicate}};Message.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(newDestinationName){this._setDestinationName(newDestinationName)},get qos(){return this._getQos()},set qos(newQos){this._setQos(newQos)},get retained(){return this._getRetained()},set retained(newRetained){this._setRetained(newRetained)},get duplicate(){return this._getDuplicate()},set duplicate(newDuplicate){this._setDuplicate(newDuplicate)}};return{Client:Client,Message:Message}}(window);