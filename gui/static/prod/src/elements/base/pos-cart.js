import{utilsMixin}from"../../core/mixins/utils-mixin.js";import{dataSourceMixin}from"../../core/mixins/datasource-mixin.js";import{mqttMixin}from"../../core/mixins/mqtt-mixin.js";import{BaseElement}from"../../core/base-element.js";export const PosCartBase=class extends utilsMixin(mqttMixin(dataSourceMixin(BaseElement))){static get is(){return"pos-cart"}static get properties(){return{icon:String,target:String,data_name:String,service:String,params:{type:Object,value:{}},color:String,_postl:Object,inline:{type:Object,value:function(){return this}},sums:Object,loading:{type:Boolean,value:!1},title:String,maxlength:Number,pattern:String,required:Boolean,multi:Boolean,cart_items:String,col_sums:Array,currentData:{type:Array,notify:!0}}}static get behaviors(){return[MqttBehavior]}getName(){return this.e.formName}getValue(){return this.cart_items}validate(){return!0}_getImagePath(url){return this.media_url+url}dscDataName(){return this.data_name}repeatObject(item){var items=[];if("object"==typeof item){var count=0;for(var x in item){items.push([count,x,item[x]]);count++}}return items}computeTarget(){return this.target}computeParams(link){return JSON.stringify(link.params)}firstUpdated(changedProperties){super.firstUpdated(changedProperties);this;this;this.loader.then(()=>{})}mergeParams(obj1,obj2){var obj3={};for(var attrname in obj2){obj3[attrname]=obj2[attrname]}for(var attrname in obj1){obj3[attrname]=obj1[attrname]}return obj3}onMqttMessage(message){var self=this;console.log("pos cart on-mqtt-message");var payload=JSON.parse(message.payloadString);console.info(payload);for(var i=0,action;i<payload.action.length;i++){action=payload.action[i];if("REPLACE"==action){self.cols=payload.cols;self.rows=payload.rows;const items=[],itemIds=[],sums={},config=document.querySelector("switch-config");for(var i=0;i<self.rows.length;i++){for(var item={},itemLinks=[],j=0;j<self.cols.length;j++){if("number"==self.cols[j].type){if(!sums[self.cols[j].value]){sums[self.cols[j].value]={name:self.cols[j].label,value:0}}sums[self.cols[j].value].value+=parseInt(self.rows[i][j])}if("href"==self.cols[j].type){var links=self.cols[j].links;for(var link in links){var linkObject=links[link],linkProcessed={};linkProcessed.service=linkObject.service;linkProcessed.icon=linkObject.icon;linkProcessed.params={};for(var linkParamKey in linkObject.params){var linkParam=linkObject.params[linkParamKey];linkProcessed.params[linkParamKey]=item[linkParam]}var endpoint=config.protocol+"//"+config.hostname+"/"+linkProcessed.service+"/?",params_string=Object.keys(linkProcessed.params).map(function(k){return encodeURIComponent(k)+"="+encodeURIComponent(linkProcessed.params[k])}).join("&");endpoint=endpoint+params_string;linkProcessed.fullUrl=endpoint;itemLinks.push(linkProcessed)}}else{item[self.cols[j].label]=self.rows[i][j]}}item.inline=itemLinks;items.push(item);itemIds.push(item.id)}self.currentData=items;self.col_sums=Object.values(sums);self.cart_items=itemIds.join(",")}else if("COMPARE"==action){}else if("APPEND"==action){}}}init(pElement,loader){super.init(pElement,loader);var self=this;self.title=PosCartBase.toTitleCase(pElement.name);self.icon=pElement.icon;self.service=pElement.service;self.params=loader.pl.params;self.data_name=pElement.defaultValue;self.maxlength=pElement.max;self.loader=this.loadData()}};